........................................................................ [  5%]
........................................................................ [ 10%]
........................................................................ [ 15%]
.........................................................F.............. [ 20%]
........................................................................ [ 25%]
........................................................................ [ 30%]
........................................................................ [ 35%]
........................................................................ [ 40%]
........................................................................ [ 45%]
........................................................................ [ 50%]
........................................................................ [ 55%]
........................................................................ [ 60%]
........................................................................ [ 66%]
........................................................................ [ 71%]
........................................................................ [ 76%]
........................................................................ [ 81%]
............s........................................................... [ 86%]
........................................................................ [ 91%]
...............................................................F........ [ 96%]
..................................................                       [100%]
=================================== FAILURES ===================================
____________________________ test_sync_proxy_close _____________________________

    @contextlib.contextmanager
    def map_httpcore_exceptions() -> typing.Iterator[None]:
        global HTTPCORE_EXC_MAP
        if len(HTTPCORE_EXC_MAP) == 0:
            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()
        try:
>           yield

httpx/_transports/default.py:101: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
httpx/_transports/default.py:250: in handle_request
    resp = self._pool.handle_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../flaky-tests-comparative-study/.venv-httpx/lib/python3.12/site-packages/httpcore/_sync/connection_pool.py:256: in handle_request
    raise exc from None
../../flaky-tests-comparative-study/.venv-httpx/lib/python3.12/site-packages/httpcore/_sync/connection_pool.py:236: in handle_request
    response = connection.handle_request(
../../flaky-tests-comparative-study/.venv-httpx/lib/python3.12/site-packages/httpcore/_sync/connection.py:103: in handle_request
    return self._connection.handle_request(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../flaky-tests-comparative-study/.venv-httpx/lib/python3.12/site-packages/httpcore/_sync/http11.py:136: in handle_request
    raise exc
../../flaky-tests-comparative-study/.venv-httpx/lib/python3.12/site-packages/httpcore/_sync/http11.py:106: in handle_request
    ) = self._receive_response_headers(**kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../flaky-tests-comparative-study/.venv-httpx/lib/python3.12/site-packages/httpcore/_sync/http11.py:177: in _receive_response_headers
    event = self._receive_event(timeout=timeout)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../flaky-tests-comparative-study/.venv-httpx/lib/python3.12/site-packages/httpcore/_sync/http11.py:217: in _receive_event
    data = self._network_stream.read(
../../flaky-tests-comparative-study/.venv-httpx/lib/python3.12/site-packages/httpcore/_backends/sync.py:126: in read
    with map_exceptions(exc_map):
/usr/lib/python3.12/contextlib.py:158: in __exit__
    self.gen.throw(value)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

map = {<class 'TimeoutError'>: <class 'httpcore.ReadTimeout'>, <class 'OSError'>: <class 'httpcore.ReadError'>}

    @contextlib.contextmanager
    def map_exceptions(map: ExceptionMapping) -> typing.Iterator[None]:
        try:
            yield
        except Exception as exc:  # noqa: PIE786
            for from_exc, to_exc in map.items():
                if isinstance(exc, from_exc):
>                   raise to_exc(exc) from exc
E                   httpcore.ReadTimeout: timed out

../../flaky-tests-comparative-study/.venv-httpx/lib/python3.12/site-packages/httpcore/_exceptions.py:14: ReadTimeout

The above exception was the direct cause of the following exception:

    @pytest.mark.network
    def test_sync_proxy_close():
        try:
            transport = httpx.HTTPTransport(proxy=PROXY_URL)
            client = httpx.Client(mounts={"https://": transport})
>           client.get("http://example.com")

tests/client/test_proxies.py:118: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
httpx/_client.py:1053: in get
    return self.request(
httpx/_client.py:825: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
httpx/_client.py:914: in send
    response = self._send_handling_auth(
httpx/_client.py:942: in _send_handling_auth
    response = self._send_handling_redirects(
httpx/_client.py:979: in _send_handling_redirects
    response = self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
httpx/_client.py:1014: in _send_single_request
    response = transport.handle_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
httpx/_transports/default.py:249: in handle_request
    with map_httpcore_exceptions():
/usr/lib/python3.12/contextlib.py:158: in __exit__
    self.gen.throw(value)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    @contextlib.contextmanager
    def map_httpcore_exceptions() -> typing.Iterator[None]:
        global HTTPCORE_EXC_MAP
        if len(HTTPCORE_EXC_MAP) == 0:
            HTTPCORE_EXC_MAP = _load_httpcore_exceptions()
        try:
            yield
        except Exception as exc:
            mapped_exc = None
    
            for from_exc, to_exc in HTTPCORE_EXC_MAP.items():
                if not isinstance(exc, from_exc):
                    continue
                # We want to map to the most specific exception we can find.
                # Eg if `exc` is an `httpcore.ReadTimeout`, we want to map to
                # `httpx.ReadTimeout`, not just `httpx.TimeoutException`.
                if mapped_exc is None or issubclass(to_exc, mapped_exc):
                    mapped_exc = to_exc
    
            if mapped_exc is None:  # pragma: no cover
                raise
    
            message = str(exc)
>           raise mapped_exc(message) from exc
E           httpx.ReadTimeout: timed out

httpx/_transports/default.py:118: ReadTimeout
___________________________ test_write_timeout[trio] ___________________________

agen = <async_generator object ByteStream.__aiter__ at 0x766f86fea8c0>

    @_core.enable_ki_protection
    def finalizer(agen: AsyncGeneratorType[object, NoReturn]) -> None:
        try:
            self.foreign.remove(id(agen))
        except KeyError:
            is_ours = True
        else:
            is_ours = False
    
        agen_name = name_asyncgen(agen)
        if is_ours:
            runner.entry_queue.run_sync_soon(
                finalize_in_trio_context,
                agen,
                agen_name,
            )
    
            # Do this last, because it might raise an exception
            # depending on the user's warnings filter. (That
            # exception will be printed to the terminal and
            # ignored, since we're running in GC context.)
>           warnings.warn(
                f"Async generator {agen_name!r} was garbage collected before it "
                "had been exhausted. Surround its use in 'async with "
                "aclosing(...):' to ensure that it gets cleaned up as soon as "
                "you're done using it.",
                ResourceWarning,
                stacklevel=2,
                source=agen,
            )
E           ResourceWarning: Async generator 'httpx._content.ByteStream.__aiter__' was garbage collected before it had been exhausted. Surround its use in 'async with aclosing(...):' to ensure that it gets cleaned up as soon as you're done using it.

../../flaky-tests-comparative-study/.venv-httpx/lib/python3.12/site-packages/trio/_core/_asyncgens.py:122: ResourceWarning

The above exception was the direct cause of the following exception:

cls = <class '_pytest.runner.CallInfo'>
func = <function call_and_report.<locals>.<lambda> at 0x766f85c8ed40>
when = 'call'
reraise = (<class '_pytest.outcomes.Exit'>, <class 'KeyboardInterrupt'>)

    @classmethod
    def from_call(
        cls,
        func: Callable[[], TResult],
        when: Literal["collect", "setup", "call", "teardown"],
        reraise: type[BaseException] | tuple[type[BaseException], ...] | None = None,
    ) -> CallInfo[TResult]:
        """Call func, wrapping the result in a CallInfo.
    
        :param func:
            The function to call. Called without arguments.
        :type func: Callable[[], _pytest.runner.TResult]
        :param when:
            The phase in which the function is called.
        :param reraise:
            Exception or exceptions that shall propagate if raised by the
            function, instead of being wrapped in the CallInfo.
        """
        excinfo = None
        instant = timing.Instant()
        try:
>           result: TResult | None = func()
                                     ^^^^^^

../../flaky-tests-comparative-study/.venv-httpx/lib/python3.12/site-packages/_pytest/runner.py:353: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
../../flaky-tests-comparative-study/.venv-httpx/lib/python3.12/site-packages/_pytest/runner.py:245: in <lambda>
    lambda: runtest_hook(item=item, **kwds),
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../flaky-tests-comparative-study/.venv-httpx/lib/python3.12/site-packages/pluggy/_hooks.py:512: in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../flaky-tests-comparative-study/.venv-httpx/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../flaky-tests-comparative-study/.venv-httpx/lib/python3.12/site-packages/_pytest/logging.py:850: in pytest_runtest_call
    yield
../../flaky-tests-comparative-study/.venv-httpx/lib/python3.12/site-packages/_pytest/capture.py:900: in pytest_runtest_call
    return (yield)
            ^^^^^
../../flaky-tests-comparative-study/.venv-httpx/lib/python3.12/site-packages/_pytest/skipping.py:268: in pytest_runtest_call
    return (yield)
            ^^^^^
../../flaky-tests-comparative-study/.venv-httpx/lib/python3.12/site-packages/_pytest/unraisableexception.py:158: in pytest_runtest_call
    collect_unraisable(item.config)
../../flaky-tests-comparative-study/.venv-httpx/lib/python3.12/site-packages/_pytest/unraisableexception.py:79: in collect_unraisable
    raise errors[0]
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

config = <_pytest.config.Config object at 0x766f8a42d7f0>

    def collect_unraisable(config: Config) -> None:
        pop_unraisable = config.stash[unraisable_exceptions].pop
        errors: list[pytest.PytestUnraisableExceptionWarning | RuntimeError] = []
        meta = None
        hook_error = None
        try:
            while True:
                try:
                    meta = pop_unraisable()
                except IndexError:
                    break
    
                if isinstance(meta, BaseException):
                    hook_error = RuntimeError("Failed to process unraisable exception")
                    hook_error.__cause__ = meta
                    errors.append(hook_error)
                    continue
    
                msg = meta.msg
                try:
>                   warnings.warn(pytest.PytestUnraisableExceptionWarning(msg))
E                   pytest.PytestUnraisableExceptionWarning: Exception ignored in: <async_generator object ByteStream.__aiter__ at 0x766f86fea8c0>
E                   Enable tracemalloc to get traceback where the object was allocated.
E                   See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

../../flaky-tests-comparative-study/.venv-httpx/lib/python3.12/site-packages/_pytest/unraisableexception.py:67: PytestUnraisableExceptionWarning
----------------------------- Captured stdout call -----------------------------
INFO:     127.0.0.1:33586 - "PUT /slow_response HTTP/1.1" 200 OK
=========================== short test summary info ============================
SKIPPED [1] tests/client/test_auth.py:273: netrc files without a password are valid from Python >= 3.11
2 failed, 1415 passed, 1 skipped in 19.54s
